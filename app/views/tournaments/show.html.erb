<div class="page-header">
  <h1><%= @tournament.name %></h1>
</div>

<p>There are <%= @pending.count %> games to be processed on <%= time_tag (Time.zone.now + 1.week).beginning_of_week %>.</p>

<% if @challenges.any? %>
  <h2>Challenges</h2>
  <% @challenges.each do |challenge| %>
    <p><%= link_to "#{challenge.challenger.name} vs #{challenge.defender.name}", challenge_path(challenge) %>, expires in <%= distance_of_time_in_words challenge.processed_at , Time.zone.now %></p>
  <% end %>
<% end %>

<h2>Ladder</h2>
<table class="table">
  <thead>
    <tr>
      <th>Rank</th>
      <th>Player</th>
      <th>Rating</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @glicko2_ratings.each_with_index do |rating, index| %>
      <tr>
        <td><%= index + 1 %></td>
        <td><%= profile_link_tag rating.user %></td>
        <td><%= number_with_precision rating.low_rank, :precision => 0 %> - <%= number_with_precision rating.high_rank, :precision => 0 %></td>
        <td>
          <% if rating.user != current_user && @tournament.has_user?(current_user) %>
            <div class="btn-group">
              <%= link_to new_challenge_path(:defender_id => rating.user, :tournament_id => @tournament), :class => 'btn' do %>Challenge<% end %>
              <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <li><%= link_to 'Log a game', new_tournament_game_path(@tournament, :user_id => rating.user) %></li>
              </ul>
            </div>
          <% end %>
        </td>
      </tr>
    <% end %>
    <% if @tournament.glicko2_ratings.empty? %>
      <tr colspan="3">
        <td>There are no rated players.</td>
      </tr>
    <% end %>
  </tbody>
</table>
